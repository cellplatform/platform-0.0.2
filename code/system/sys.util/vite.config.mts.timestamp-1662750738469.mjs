// ../../compiler/builder.node/Config.Vite.mts
import { defineConfig } from "vite";

// ../../compiler/builder.node/common/fs.mts
import fsextra from "fs-extra";
import glob from "glob";
import path from "path";
var fs = {
  ...fsextra,
  ...path,
  glob: {
    find(pattern) {
      return new Promise((resolve, reject) => {
        glob(pattern, (err, matches) => err ? reject(err) : resolve(matches));
      });
    }
  }
};

// ../../compiler/builder.node/common/libs.mts
import { execa } from "execa";
import pc from "picocolors";
import rimraf from "rimraf";

// ../../compiler/builder.node/Config.Vite.mts
var ViteConfig = {
  defaults: {
    test() {
      return {
        globals: false,
        include: ["**/*.{TEST,SPEC}.{ts,tsx,mts,mtsx}"]
      };
    },
    lib(dir, name) {
      return {
        name,
        entry: `${dir}/src/index.mts`,
        fileName: "index",
        formats: ["es"]
      };
    }
  },
  default(dir, modify) {
    return defineConfig(async ({ command, mode }) => {
      const pkg = await fs.readJson(fs.join(dir, "package.json"));
      const deps = { ...pkg.dependencies, ...pkg.devDependencies };
      const name = pkg.name;
      const lib = ViteConfig.defaults.lib(dir, name);
      const external = [];
      const rollupOptions = {
        external,
        output: { globals: {} }
      };
      const config = {
        plugins: [],
        test: ViteConfig.defaults.test(),
        build: { lib, rollupOptions }
      };
      const args = {
        ctx: { name, command, mode, config, pkg, deps },
        addExternalDependency(moduleName) {
          asArray(moduleName).filter((name2) => !external.includes(name2)).forEach((name2) => external.push(name2));
        }
      };
      Object.keys(deps).forEach((moduleName) => args.addExternalDependency(moduleName));
      await (modify == null ? void 0 : modify(args));
      return config;
    });
  }
};
function asArray(input) {
  return (Array.isArray(input) ? input : [input]).filter(Boolean);
}

// vite.config.mts
var __vite_injected_original_dirname = "/Users/phil/code/CellPlatform/platform-0.2.0/code/system/sys.util";
var vite_config_default = ViteConfig.default(__vite_injected_original_dirname);
export {
  vite_config_default as default
};
//# sourceMappingURL=data:application/json;base64,ewogICJ2ZXJzaW9uIjogMywKICAic291cmNlcyI6IFsiLi4vLi4vY29tcGlsZXIvYnVpbGRlci5ub2RlL0NvbmZpZy5WaXRlLm10cyIsICIuLi8uLi9jb21waWxlci9idWlsZGVyLm5vZGUvY29tbW9uL2ZzLm10cyIsICIuLi8uLi9jb21waWxlci9idWlsZGVyLm5vZGUvY29tbW9uL2xpYnMubXRzIiwgInZpdGUuY29uZmlnLm10cyJdLAogICJzb3VyY2VzQ29udGVudCI6IFsiY29uc3QgX192aXRlX2luamVjdGVkX29yaWdpbmFsX2Rpcm5hbWUgPSBcIi9Vc2Vycy9waGlsL2NvZGUvQ2VsbFBsYXRmb3JtL3BsYXRmb3JtLTAuMi4wL2NvZGUvY29tcGlsZXIvYnVpbGRlci5ub2RlXCI7Y29uc3QgX192aXRlX2luamVjdGVkX29yaWdpbmFsX2ZpbGVuYW1lID0gXCIvVXNlcnMvcGhpbC9jb2RlL0NlbGxQbGF0Zm9ybS9wbGF0Zm9ybS0wLjIuMC9jb2RlL2NvbXBpbGVyL2J1aWxkZXIubm9kZS9Db25maWcuVml0ZS5tdHNcIjtjb25zdCBfX3ZpdGVfaW5qZWN0ZWRfb3JpZ2luYWxfaW1wb3J0X21ldGFfdXJsID0gXCJmaWxlOi8vL1VzZXJzL3BoaWwvY29kZS9DZWxsUGxhdGZvcm0vcGxhdGZvcm0tMC4yLjAvY29kZS9jb21waWxlci9idWlsZGVyLm5vZGUvQ29uZmlnLlZpdGUubXRzXCI7Ly8vIDxyZWZlcmVuY2UgdHlwZXM9XCJ2aXRlc3RcIiAvPlxuXG5pbXBvcnQgeyBkZWZpbmVDb25maWcsIExpYnJhcnlPcHRpb25zLCBVc2VyQ29uZmlnIH0gZnJvbSAndml0ZSc7XG5pbXBvcnQgeyBmcyB9IGZyb20gJy4vY29tbW9uL2luZGV4Lm1qcyc7XG5pbXBvcnQgdHlwZSB7IFJvbGx1cE9wdGlvbnMgfSBmcm9tICdyb2xsdXAnO1xuXG5leHBvcnQgdHlwZSBQYWNrYWdlSnNvbiA9IHtcbiAgbmFtZTogc3RyaW5nO1xuICB2ZXJzaW9uOiBzdHJpbmc7XG4gIHR5cGVzOiBzdHJpbmc7XG4gIHR5cGU6ICdtb2R1bGUnO1xuICBkZXBlbmRlbmNpZXM/OiB7IFtrZXk6IHN0cmluZ106IHN0cmluZyB9O1xuICBkZXZEZXBlbmRlbmNpZXM/OiB7IFtrZXk6IHN0cmluZ106IHN0cmluZyB9O1xufTtcblxudHlwZSBNb2RpZnlDb25maWcgPSAoYXJnczogTW9kaWZ5Q29uZmlnQXJncykgPT4gUHJvbWlzZTx1bmtub3duPiB8IHVua25vd247XG50eXBlIE1vZGlmeUNvbmZpZ0FyZ3MgPSB7XG4gIHJlYWRvbmx5IGN0eDogTW9kaWZ5Q29uZmlnQ3R4O1xuICBhZGRFeHRlcm5hbERlcGVuZGVuY3kobW9kdWxlTmFtZTogc3RyaW5nIHwgc3RyaW5nW10pOiB2b2lkO1xufTtcbnR5cGUgTW9kaWZ5Q29uZmlnQ3R4ID0ge1xuICByZWFkb25seSBuYW1lOiBzdHJpbmc7XG4gIHJlYWRvbmx5IGNvbW1hbmQ6ICdidWlsZCcgfCAnc2VydmUnO1xuICByZWFkb25seSBtb2RlOiBzdHJpbmc7XG4gIHJlYWRvbmx5IHBrZzogUGFja2FnZUpzb247XG4gIHJlYWRvbmx5IGRlcHM6IHsgW2tleTogc3RyaW5nXTogc3RyaW5nIH07IC8vIEFsbCBkZXBlbmRlbmNpZXMgKGluY2wuIFwiZGV2XCIpXG4gIHJlYWRvbmx5IGNvbmZpZzogVXNlckNvbmZpZztcbn07XG5cbi8qKlxuICogQ29tbW9uIGNvbmZpZ3VyYXRpb24gZGVmYXVsdHMuXG4gKi9cbmV4cG9ydCBjb25zdCBWaXRlQ29uZmlnID0ge1xuICBkZWZhdWx0czoge1xuICAgIC8qKlxuICAgICAqIFRlc3QgcnVubmVyLlxuICAgICAqL1xuICAgIHRlc3QoKSB7XG4gICAgICByZXR1cm4ge1xuICAgICAgICBnbG9iYWxzOiBmYWxzZSxcbiAgICAgICAgaW5jbHVkZTogWycqKi8qLntURVNULFNQRUN9Lnt0cyx0c3gsbXRzLG10c3h9J10sXG4gICAgICB9O1xuICAgIH0sXG5cbiAgICAvKipcbiAgICAgKiBCdWlsZGVyIG9wdGlvbnMuXG4gICAgICovXG4gICAgbGliKGRpcjogc3RyaW5nLCBuYW1lOiBzdHJpbmcpOiBMaWJyYXJ5T3B0aW9ucyB7XG4gICAgICByZXR1cm4ge1xuICAgICAgICBuYW1lLFxuICAgICAgICBlbnRyeTogYCR7ZGlyfS9zcmMvaW5kZXgubXRzYCxcbiAgICAgICAgZmlsZU5hbWU6ICdpbmRleCcsXG4gICAgICAgIGZvcm1hdHM6IFsnZXMnXSxcbiAgICAgIH07XG4gICAgfSxcbiAgfSxcblxuICAvKipcbiAgICogQnVpbGQgY29uZmlndXJhdGlvbiBnZW5lcmF0b3IgKHdpdGggc3RhbmRhcmQgZGVmYXVsdHMpLlxuICAgKi9cbiAgZGVmYXVsdChkaXI6IHN0cmluZywgbW9kaWZ5PzogTW9kaWZ5Q29uZmlnKSB7XG4gICAgcmV0dXJuIGRlZmluZUNvbmZpZyhhc3luYyAoeyBjb21tYW5kLCBtb2RlIH0pID0+IHtcbiAgICAgIGNvbnN0IHBrZyA9IChhd2FpdCBmcy5yZWFkSnNvbihmcy5qb2luKGRpciwgJ3BhY2thZ2UuanNvbicpKSkgYXMgUGFja2FnZUpzb247XG4gICAgICBjb25zdCBkZXBzID0geyAuLi5wa2cuZGVwZW5kZW5jaWVzLCAuLi5wa2cuZGV2RGVwZW5kZW5jaWVzIH07XG4gICAgICBjb25zdCBuYW1lID0gcGtnLm5hbWU7XG4gICAgICBjb25zdCBsaWIgPSBWaXRlQ29uZmlnLmRlZmF1bHRzLmxpYihkaXIsIG5hbWUpO1xuXG4gICAgICAvKipcbiAgICAgICAqIFZpdGUgY29uZmlndXJhdGlvbi5cbiAgICAgICAqL1xuICAgICAgY29uc3QgZXh0ZXJuYWw6IHN0cmluZ1tdID0gW107XG4gICAgICBjb25zdCByb2xsdXBPcHRpb25zOiBSb2xsdXBPcHRpb25zID0ge1xuICAgICAgICBleHRlcm5hbCxcbiAgICAgICAgb3V0cHV0OiB7IGdsb2JhbHM6IHt9IH0sXG4gICAgICB9O1xuXG4gICAgICBjb25zdCBjb25maWc6IFVzZXJDb25maWcgPSB7XG4gICAgICAgIHBsdWdpbnM6IFtdLFxuICAgICAgICB0ZXN0OiBWaXRlQ29uZmlnLmRlZmF1bHRzLnRlc3QoKSxcbiAgICAgICAgYnVpbGQ6IHsgbGliLCByb2xsdXBPcHRpb25zIH0sXG4gICAgICB9O1xuXG4gICAgICAvKipcbiAgICAgICAqIE1vZGlmaWNhdGlvbiBJb0MgKGNhbGxlZCB3aXRoaW4gZWFjaCBtb2R1bGUgdG8gcGVyZm9ybSBzcGVjaWZpYyBhZGp1c3RtZW50cykuXG4gICAgICAgKi9cbiAgICAgIGNvbnN0IGFyZ3M6IE1vZGlmeUNvbmZpZ0FyZ3MgPSB7XG4gICAgICAgIGN0eDogeyBuYW1lLCBjb21tYW5kLCBtb2RlLCBjb25maWcsIHBrZywgZGVwcyB9LFxuICAgICAgICBhZGRFeHRlcm5hbERlcGVuZGVuY3kobW9kdWxlTmFtZSkge1xuICAgICAgICAgIGFzQXJyYXkobW9kdWxlTmFtZSlcbiAgICAgICAgICAgIC5maWx0ZXIoKG5hbWUpID0+ICFleHRlcm5hbC5pbmNsdWRlcyhuYW1lKSlcbiAgICAgICAgICAgIC5mb3JFYWNoKChuYW1lKSA9PiBleHRlcm5hbC5wdXNoKG5hbWUpKTtcbiAgICAgICAgfSxcbiAgICAgIH07XG5cbiAgICAgIE9iamVjdC5rZXlzKGRlcHMpLmZvckVhY2goKG1vZHVsZU5hbWUpID0+IGFyZ3MuYWRkRXh0ZXJuYWxEZXBlbmRlbmN5KG1vZHVsZU5hbWUpKTtcbiAgICAgIGF3YWl0IG1vZGlmeT8uKGFyZ3MpO1xuICAgICAgcmV0dXJuIGNvbmZpZztcbiAgICB9KTtcbiAgfSxcbn07XG5cbi8qKlxuICogW0hlbHBlcnNdXG4gKi9cblxuZnVuY3Rpb24gYXNBcnJheTxUPihpbnB1dDogVCB8IFRbXSkge1xuICByZXR1cm4gKEFycmF5LmlzQXJyYXkoaW5wdXQpID8gaW5wdXQgOiBbaW5wdXRdKS5maWx0ZXIoQm9vbGVhbik7XG59XG4iLCAiY29uc3QgX192aXRlX2luamVjdGVkX29yaWdpbmFsX2Rpcm5hbWUgPSBcIi9Vc2Vycy9waGlsL2NvZGUvQ2VsbFBsYXRmb3JtL3BsYXRmb3JtLTAuMi4wL2NvZGUvY29tcGlsZXIvYnVpbGRlci5ub2RlL2NvbW1vblwiO2NvbnN0IF9fdml0ZV9pbmplY3RlZF9vcmlnaW5hbF9maWxlbmFtZSA9IFwiL1VzZXJzL3BoaWwvY29kZS9DZWxsUGxhdGZvcm0vcGxhdGZvcm0tMC4yLjAvY29kZS9jb21waWxlci9idWlsZGVyLm5vZGUvY29tbW9uL2ZzLm10c1wiO2NvbnN0IF9fdml0ZV9pbmplY3RlZF9vcmlnaW5hbF9pbXBvcnRfbWV0YV91cmwgPSBcImZpbGU6Ly8vVXNlcnMvcGhpbC9jb2RlL0NlbGxQbGF0Zm9ybS9wbGF0Zm9ybS0wLjIuMC9jb2RlL2NvbXBpbGVyL2J1aWxkZXIubm9kZS9jb21tb24vZnMubXRzXCI7aW1wb3J0IGZzZXh0cmEgZnJvbSAnZnMtZXh0cmEnO1xuaW1wb3J0IGdsb2IgZnJvbSAnZ2xvYic7XG5pbXBvcnQgcGF0aCBmcm9tICdwYXRoJztcblxuLyoqXG4gKiBOb2RlIGZpbGVzeXN0ZW0gYWNjZXNzLlxuICovXG5leHBvcnQgY29uc3QgZnMgPSB7XG4gIC4uLmZzZXh0cmEsXG4gIC4uLnBhdGgsXG4gIGdsb2I6IHtcbiAgICBmaW5kKHBhdHRlcm46IHN0cmluZykge1xuICAgICAgcmV0dXJuIG5ldyBQcm9taXNlPHN0cmluZ1tdPigocmVzb2x2ZSwgcmVqZWN0KSA9PiB7XG4gICAgICAgIGdsb2IocGF0dGVybiwgKGVyciwgbWF0Y2hlcykgPT4gKGVyciA/IHJlamVjdChlcnIpIDogcmVzb2x2ZShtYXRjaGVzKSkpO1xuICAgICAgfSk7XG4gICAgfSxcbiAgfSxcbn07XG4iLCAiY29uc3QgX192aXRlX2luamVjdGVkX29yaWdpbmFsX2Rpcm5hbWUgPSBcIi9Vc2Vycy9waGlsL2NvZGUvQ2VsbFBsYXRmb3JtL3BsYXRmb3JtLTAuMi4wL2NvZGUvY29tcGlsZXIvYnVpbGRlci5ub2RlL2NvbW1vblwiO2NvbnN0IF9fdml0ZV9pbmplY3RlZF9vcmlnaW5hbF9maWxlbmFtZSA9IFwiL1VzZXJzL3BoaWwvY29kZS9DZWxsUGxhdGZvcm0vcGxhdGZvcm0tMC4yLjAvY29kZS9jb21waWxlci9idWlsZGVyLm5vZGUvY29tbW9uL2xpYnMubXRzXCI7Y29uc3QgX192aXRlX2luamVjdGVkX29yaWdpbmFsX2ltcG9ydF9tZXRhX3VybCA9IFwiZmlsZTovLy9Vc2Vycy9waGlsL2NvZGUvQ2VsbFBsYXRmb3JtL3BsYXRmb3JtLTAuMi4wL2NvZGUvY29tcGlsZXIvYnVpbGRlci5ub2RlL2NvbW1vbi9saWJzLm10c1wiO2ltcG9ydCB7IGV4ZWNhIH0gZnJvbSAnZXhlY2EnO1xuaW1wb3J0IHBjIGZyb20gJ3BpY29jb2xvcnMnO1xuaW1wb3J0IHJpbXJhZiBmcm9tICdyaW1yYWYnO1xuXG5leHBvcnQgeyBwYywgZXhlY2EsIHJpbXJhZiB9O1xuIiwgImNvbnN0IF9fdml0ZV9pbmplY3RlZF9vcmlnaW5hbF9kaXJuYW1lID0gXCIvVXNlcnMvcGhpbC9jb2RlL0NlbGxQbGF0Zm9ybS9wbGF0Zm9ybS0wLjIuMC9jb2RlL3N5c3RlbS9zeXMudXRpbFwiO2NvbnN0IF9fdml0ZV9pbmplY3RlZF9vcmlnaW5hbF9maWxlbmFtZSA9IFwiL1VzZXJzL3BoaWwvY29kZS9DZWxsUGxhdGZvcm0vcGxhdGZvcm0tMC4yLjAvY29kZS9zeXN0ZW0vc3lzLnV0aWwvdml0ZS5jb25maWcubXRzXCI7Y29uc3QgX192aXRlX2luamVjdGVkX29yaWdpbmFsX2ltcG9ydF9tZXRhX3VybCA9IFwiZmlsZTovLy9Vc2Vycy9waGlsL2NvZGUvQ2VsbFBsYXRmb3JtL3BsYXRmb3JtLTAuMi4wL2NvZGUvc3lzdGVtL3N5cy51dGlsL3ZpdGUuY29uZmlnLm10c1wiO2ltcG9ydCB7IFZpdGVDb25maWcgfSBmcm9tICcuLi8uLi8uLi9jb25maWcubWpzJztcbmV4cG9ydCBkZWZhdWx0IFZpdGVDb25maWcuZGVmYXVsdChfX2Rpcm5hbWUpO1xuIl0sCiAgIm1hcHBpbmdzIjogIjtBQUVBLFNBQVMsb0JBQWdEOzs7QUNGbVYsT0FBTyxhQUFhO0FBQ2hhLE9BQU8sVUFBVTtBQUNqQixPQUFPLFVBQVU7QUFLVixJQUFNLEtBQUs7QUFBQSxFQUNoQixHQUFHO0FBQUEsRUFDSCxHQUFHO0FBQUEsRUFDSCxNQUFNO0FBQUEsSUFDSixLQUFLLFNBQWlCO0FBQ3BCLGFBQU8sSUFBSSxRQUFrQixDQUFDLFNBQVMsV0FBVztBQUNoRCxhQUFLLFNBQVMsQ0FBQyxLQUFLLFlBQWEsTUFBTSxPQUFPLEdBQUcsSUFBSSxRQUFRLE9BQU8sQ0FBRTtBQUFBLE1BQ3hFLENBQUM7QUFBQSxJQUNIO0FBQUEsRUFDRjtBQUNGOzs7QUNqQmdaLFNBQVMsYUFBYTtBQUN0YSxPQUFPLFFBQVE7QUFDZixPQUFPLFlBQVk7OztBRjhCWixJQUFNLGFBQWE7QUFBQSxFQUN4QixVQUFVO0FBQUEsSUFJUixPQUFPO0FBQ0wsYUFBTztBQUFBLFFBQ0wsU0FBUztBQUFBLFFBQ1QsU0FBUyxDQUFDLG9DQUFvQztBQUFBLE1BQ2hEO0FBQUEsSUFDRjtBQUFBLElBS0EsSUFBSSxLQUFhLE1BQThCO0FBQzdDLGFBQU87QUFBQSxRQUNMO0FBQUEsUUFDQSxPQUFPLEdBQUc7QUFBQSxRQUNWLFVBQVU7QUFBQSxRQUNWLFNBQVMsQ0FBQyxJQUFJO0FBQUEsTUFDaEI7QUFBQSxJQUNGO0FBQUEsRUFDRjtBQUFBLEVBS0EsUUFBUSxLQUFhLFFBQXVCO0FBQzFDLFdBQU8sYUFBYSxPQUFPLEVBQUUsU0FBUyxLQUFLLE1BQU07QUFDL0MsWUFBTSxNQUFPLE1BQU0sR0FBRyxTQUFTLEdBQUcsS0FBSyxLQUFLLGNBQWMsQ0FBQztBQUMzRCxZQUFNLE9BQU8sRUFBRSxHQUFHLElBQUksY0FBYyxHQUFHLElBQUksZ0JBQWdCO0FBQzNELFlBQU0sT0FBTyxJQUFJO0FBQ2pCLFlBQU0sTUFBTSxXQUFXLFNBQVMsSUFBSSxLQUFLLElBQUk7QUFLN0MsWUFBTSxXQUFxQixDQUFDO0FBQzVCLFlBQU0sZ0JBQStCO0FBQUEsUUFDbkM7QUFBQSxRQUNBLFFBQVEsRUFBRSxTQUFTLENBQUMsRUFBRTtBQUFBLE1BQ3hCO0FBRUEsWUFBTSxTQUFxQjtBQUFBLFFBQ3pCLFNBQVMsQ0FBQztBQUFBLFFBQ1YsTUFBTSxXQUFXLFNBQVMsS0FBSztBQUFBLFFBQy9CLE9BQU8sRUFBRSxLQUFLLGNBQWM7QUFBQSxNQUM5QjtBQUtBLFlBQU0sT0FBeUI7QUFBQSxRQUM3QixLQUFLLEVBQUUsTUFBTSxTQUFTLE1BQU0sUUFBUSxLQUFLLEtBQUs7QUFBQSxRQUM5QyxzQkFBc0IsWUFBWTtBQUNoQyxrQkFBUSxVQUFVLEVBQ2YsT0FBTyxDQUFDQSxVQUFTLENBQUMsU0FBUyxTQUFTQSxLQUFJLENBQUMsRUFDekMsUUFBUSxDQUFDQSxVQUFTLFNBQVMsS0FBS0EsS0FBSSxDQUFDO0FBQUEsUUFDMUM7QUFBQSxNQUNGO0FBRUEsYUFBTyxLQUFLLElBQUksRUFBRSxRQUFRLENBQUMsZUFBZSxLQUFLLHNCQUFzQixVQUFVLENBQUM7QUFDaEYsYUFBTSxpQ0FBUztBQUNmLGFBQU87QUFBQSxJQUNULENBQUM7QUFBQSxFQUNIO0FBQ0Y7QUFNQSxTQUFTLFFBQVcsT0FBZ0I7QUFDbEMsVUFBUSxNQUFNLFFBQVEsS0FBSyxJQUFJLFFBQVEsQ0FBQyxLQUFLLEdBQUcsT0FBTyxPQUFPO0FBQ2hFOzs7QUczR0EsSUFBTSxtQ0FBbUM7QUFDekMsSUFBTyxzQkFBUSxXQUFXLFFBQVEsZ0NBQVM7IiwKICAibmFtZXMiOiBbIm5hbWUiXQp9Cg==
